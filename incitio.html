<!DOCTYPE html>
<html lang="en">
<!--   

Incityo

1 Sep 24. First version that sort of works. Now a TODO list...

Impliment.

Debug Window
Tidy up

1. Code to remove absolute path to photos.

2. Search name/description.

3. Change container. done

4. Delete container ask what happens to children.

5. Photo of Home done

6. Shortcut keys. Pending. Low priority.

7. Import export.

8. Backups. - make it better Priority 5.

9. Low prioriy. Website. - Now have domain.

10. Android version. Maybe javascript to start with. Priority 10.

11. On click button focus photo

12. Add timestamp to json download.

12a. Alphabetical ordering in chains.


Also, regain some confidence with linux. How Apache works. PHP. etc.


https://stackoverflow.com/questions/750032/reading-file-contents-on-the-client-side-in-javascript-in-various-browsers

var file = document.getElementById("fileForUpload").files[0];
if (file) {
    var reader = new FileReader();
    reader.readAsText(file, "UTF-8");
    reader.onload = function (evt) {
        document.getElementById("fileContents").innerHTML = evt.target.result;
    }
    reader.onerror = function (evt) {
        document.getElementById("fileContents").innerHTML = "error reading file";
    }
}

-->

<head>
  <meta charset="UTF-8">
  <title>Incitio</title>

  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <style>
    .myDiv {
      border: 5px outset red;
      text-align: center;
    }

    .item-grid {
      width: 100px;
      height: 100px;
      padding: 1px;
      border-color: black;
      border-width: 2px;
    }

    body {
      width: 100%;
      margin: 0px;
      padding: 0px;
      margin: 0px;
    }

    img {
      width: 100%;
      /* or any custom size */
      height: 100%;
      object-fit: contain;
      margin: 0px;
    }

    .hasFocus {
      border: 5px outset purple;
      text-align: center;
    }
  </style>



  <style>
    .bigbtn {
      width: 400px;
      background-color: #6f8670;
      border: solid black 2px;
      color: white;
      padding: 15px;
      text-align: center;
      text-decoration: none;

      font-size: 16px;
      margin: 4px 2px;
      cursor: pointer;
    }

    .alert {
      left: calc(50% - 150px);
      width: 300px;
      height: 200px;
      top: -250px;
      border-radius: 10px;
      text-align: center;
      background-color: peachpuff;
      border: none;
      position: fixed;
      margin: 0 auto;
      display: block;
      z-index: 50;
    }

    .animate {

      animation-name: example;
      animation-duration: 5s;

    }

    @keyframes example {
      0% {
        opacity: 1;
        top: -200px;
      }

      15% {
        opacity: 1;
        top: 50px;
      }

      85% {
        top: 50px;
        opacity: 1;

      }

      99% {
        top: 50px;
        opacity: 0;

      }


    }

    /* CSS */
    .button-34 {
      background: #6b6bda;
      border-radius: 30px;
      box-shadow: #0e0b0b 0 10px 20px -10px;
      box-sizing: border-box;
      color: #FFFFFF;
      cursor: pointer;
      font-family: Inter, Helvetica, "Apple Color Emoji", "Segoe UI Emoji", NotoColorEmoji, "Noto Color Emoji", "Segoe UI Symbol", "Android Emoji", EmojiSymbols, -apple-system, system-ui, "Segoe UI", Roboto, "Helvetica Neue", "Noto Sans", sans-serif;
      font-size: 143x14;
      font-weight: 700;
      line-height: 20px;
      opacity: 1;
      outline: 0 solid transparent;
      padding: 8px 18px;
      user-select: none;
      -webkit-user-select: none;
      touch-action: manipulation;
      width: 80%;
      word-break: break-word;
      border: 0;
    }
  </style>

</head>

<script src="./incitio.js"></script>

<body>
  <button id="alertBox" class="alert">
    <h1>message</h1>
  </button>

  <div id="topDiv" class="myDiv" style="display:inline-flex;width:100%;height:800px;background-color: #6b6bda;">

  
  
    <!-- first column -->
    <div class="myDiv" style="width:20%;background-color:pink;height:800px; ">

       
      <button style="border-style: none;background-color: transparent;">
        <h4> <i class="bi-house" style="font-size: 6rem; color: cornflowerblue;"></i>InCitio V1.12</h4>
      </button>
     
      <div style="margin:auto">
        <button class="btn btn-primary dropdown-toggle " type="button" data-bs-toggle="dropdown" id="dropdownMenuButton"
          style="border-style: none;  margin-top: 10px;border-radius: 16px; ">
          <h1>+New</h1>
        </button>

        <ul class="dropdown-menu">

          <li><a class="dropdown-item" href="#" onClick="makeNewButton('c');">New Container</a>
          </li>
          <li><a class="dropdown-item" href="#" onClick="makeNewButton('i');">New Item</a>
          </li>
        </ul>
      </div>
<p></p>
      <button class="btn btn-info btn-sm" style="width:70%;margin:3px" onclick="toggleView()">Mobile View</button>
 

      <div class="myDiv" style="margin-top:20px">
        <h4>Select database</h4>
        <select id="json" style="width:90%; background-color:rgb(203, 221, 236);border-radius: 5px;">

          <script>
            for (i = 0; i < localStorage.length; i++) {
              document.write(`<option>` + localStorage.key(i) + `</option>`);
            }
          </script>

        </select>
        <p></p>

        <button class="btn btn-primary btn-sm" style="width:70%;margin:3px" onclick="getJSON()">Get Data</button>
        <br>
        <button class="btn btn-info btn-sm" style="width:70%;margin:3px" onclick="putJSON()">Save Data</button>
        <br>
        <button class="btn btn-success btn-sm" style="width:70%;margin:3px" onclick="newJSON()">New Database</button>
        <br>
        <button class="btn btn-danger btn-sm" style="width:70%;margin:3px" onclick="deleteJSON()">Delete
          Database</button>

        <!--
        <button onclick="clearStorage()">Clear</button>
        -->
      </div>

      <div class="myDiv" style="margin-top:20px">

        <h4>Backups</h4>
      

        <button class="btn btn-dark btn-sm" style="width:70%;margin:3px" onclick="up.click()">Upload Data</button>

        <div style="display:none">
          <input type="file" id="up" onchange="readText(event)" />
          <pre id="output"></pre>
        </div>
    


        <a id='a' download='JSONDownload.txt' type='text/txt'></a>
        <button class="btn btn-primary btn-sm" style="width:70%;margin:3px" onclick="a.download='IncitioDownload '  + '.txt'; downloadData()">Download Data</button>


        <button class="btn btn-info btn-sm" style="width:70%;margin:3px" onclick=" ">Export Data</button>


        <br>


      </div>





<!--
      
-->
    </div>

  

    <!-- second column -->
    <div class="myDiv" style="width:70%;background-color:rgb(26, 13, 75);height:800px">
      <div class="myDiv" style="background-color:rgb(68, 119, 94);margin:auto">
        <button id="none" class="btn btn-light" style="margin:30px; background-color:blanchedalmond;position: relative;
                width: 60%;height: 15%; border-radius: 16px; box-shadow: 5px 5px 5px gray;">
          <span class="btn-label" onclick="doSearch();"
            style="position:absolute;top:0px; left:10px; margin-bottom: 20px;">
            <i class="bi-search" style="font-size:30px"></i></span>

          <input aria-label="Search inCitio" autocomplete="off" placeholder="Search inCitio" value="" name=""
            type="text" id="search" style="padding: 0px; border:0cap; float:right;
              width: 90%;  background-color: rgb(219, 192, 192);
               z-index: 6; left: 0px;" spellcheck="false" aria-haspopup="true" aria-live="off" aria-owns="gs_sbt50">
        </button>
      </div>

      <!--    Chain   -->
      <div class="myDiv" style="background-color:white;margin:auto">
        <div id="divChain" style="text-align: left;margin-left: 10px;margin-bottom: 10px;">
          </button>
        </div>

        <!--    Items  -->
        <div style="text-align: left;padding:10px;background-color:lightcyan ;">
          <button onclick="makeNewButton('i')" style="background-color: green;color:white">+ new item</button>
          <button onclick="makeNewButton('c')" style="background-color: blue;color:white">+ new container</button>
        </div>

        <div id="divItems" style="text-align: left;margin-left: 10px;margin-bottom: 10px; ">
        </div>
      </div>


      <div class="myDiv">
        <button type="button" id="updateButton" class="btn btn-primary btn-lg btn-block" style="width:90%;margin:10px"
          onclick="showAllItems();">ShowAllItems</button>
      </div>

      <!-- photos -->
      <div class="myDiv" style="text-align:center;background-color:green  ">
        <div id="divPhotos" class="myDiv"
          style="text-align:center;width:90%;background-color: aquamarine; margin:0 auto; padding:10px;height:300px;overflow-y: scroll">
        </div>
      </div>
    </div>

    <!-- third column -->
    <div class="myDiv" style="width:30%;background-color:rgb(170, 123, 37);height:8oopx;overflow-y: scroll"> 
      <div class="myDiv" style="background-color: rgb(34, 143, 119);text-align:center;padding:5px ">
        <div>
          <img id="thePhoto" style="min-width:200px;min-height:200px">
        </div>

        <div>
          <div style="display:none">
            <input style="position:absolute;left:0px;margin-bottom:10px;" type="file" name="file" id="file"
              onchange='btn_uploadImageFile.click()'>
          </div>
          <input type="button" id="btn_uploadImageFile" value="Upload" style="display:none"
            onclick="uploadImageFile();">

          <button class="btn-light" onclick="file.click()">UPLOAD PHOTO</button>
        </div>




      </div>

      <div class="myDiv" style="background-color: blueviolet;text-align:center;padding:5px">
        <p style="color:yellow">Change Item Details</p>
        <button type="button" id="updateButton" class="btn btn-default btn-primary"
          onclick="updateItemsFromForm();">Update</button>
        <button type="button" class="btn btn-default btn-primary" onclick="deleteItem();">Delete</button>
      </div>

      <div style="background-color:white;margin:auto; padding:2px; ">
        <div style="text-align:left;background-color: cornsilk;margin-left: 10px;">
          <form>
            <!--    Form   -->
            <div class="form-group">
              <label for="inName">Name:</label>
              <input type="text" class="form-control" id="inName">
            </div>

            <div class="form-group">
              <label for="inDescription">Description</label>
              <textarea class="form-control" id="inDescription" rows="5"></textarea>
            </div>

            <div class="form-group">
              <label for="inItemId">Item Id</label>
              <input type="text" class="form-control" id="inItemId">
            </div>
            <div class="form-group">
              <label for="inParentId">Parent Id</label>
              <input type="text" class="form-control" id="inParentId">
              <p></p>
            </div>

            <div class="form-group">
              <label for="newParent">Change container:</label>
              <select id="newParent" onChange="updateButton.click()">

              </select>
            </div>

            <p></p>
            <p></p>

        </div>
      </div>

      
    </div>


  </div>



  <script>

    // TLA helpers

    function gid(name) {
      return document.getElementById(name);
    }

    function hid(el) {
      el.display = "none";
    }

    const itemObject = {
      id: "0",
      type: "c",
      parentId: "?",
      name: "home",
      description: "your humble abode",
      image: "?"
    };

   // alert(screen.width);

    let gCurrentParentId = 0; // do I need to persist this?
    function getCurrentParentId() { return gCurrentParentId; }
    function setCurrentParentId(id) { gCurrentParentId = id }

    let gItemArray = [];
    let gChainArray = [];

    gItemArray.push(itemObject);

    setCurrentRoot(0);
 
    //for (i = 0; i < localStorage.length; i++)
    //   alert(localStorage.key(i));
    //
    function f(el) {
      hid(el);
      let p = el.parentElement;

      p.innerHTML = `<span style="font-size:20px"><p> copy an image to the clipboard and then paste it here</span>`;
    }

    let gPictureBoxInnerHTML = `<button id="paste_btn" style="height:90%;width:90%;object-fit:contain;padding:20px;margin:auto" 
    onclick="f(this);">left click here to start paste</button>`;



    resetPictureBox();

    function doBefore() {
      try {

        let p = document.getElementById("picture_box");

        p.style.padding = "0px";
        p.innerHTML = "";
      }
      catch (e) { alert(e); }
    }

    function toggleView(){

      alert("toggle");

      topDiv.style.display = "inline";
      col1.style.width = "33%";
      col2.style.width = "33%";
      col3.style.width = "33%";   
    }


    function doAfter() {
      try {
        let p = document.getElementById("picture_box");
        let pictureBox = p.firstElementChild;

        thisId = (gid("inItemId")).value;

        thisIndex = getItemObjectIndexById(thisId);


        //gItemArray[thisIndex].image = pictureBox.outerHTML; // save the outerHTML
        // should I monkey with absoliute paths?
        // Not yet.
        document.activeElement.blur();
        window.focus();
      }
      catch (e) {

        alert(e);

      }

    }

    /*   gid("picture_box").addEventListener('paste',
         (ev) => {
           doBefore();
         }, true);
   
       gid("picture_box").addEventListener('paste',
         (ev) => {
           setTimeout(doAfter, 1000);
   
         }, false); */


    //  let x = localStorage.getItem("jsonStringSep4");



  </script>

  <script>
    function displace(el, options) {
      return window.displacejs(el, options);
    }
    function gid(id) {
      return document.getElementById(id);
    }
    function hid(el) {
      el.style.display = 'none';
    }
    function vid(el) {
      el.style.display = 'initial';
    }
    function tvid(el) {
      if (el.style.display == 'initial')
        hid(el)
      else vid(el);
    }
    function viz(el) {
      if (el.style.display == 'initial')
        return true; else return false;
    }
    function isa(el, c) {
      if (el == undefined || el == null || el == document)
        return false;
      if (el.classList.contains(c))
        return true; else return false;
    }


    alertBox.addEventListener("animationend", () => { alertBox.classList.remove("animate"); });

  </script>
</body>

</html>